<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Streetlight</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="grid__wrapper">
        <div class="grid__component" id="streetlight__wrapper">
            <div class="component__header">
                <span class="header__title">Lampu Jalan</span>
            </div>
            <div class="component__main">
                <span class="main__text" id="streetlight__state">OFF</span>
            </div>
            <div class="component__bottom">
                <span class="bottom__text" id="streetlight__color">White</span>
            </div>
        </div>
        <div class="grid__component" id="time__wrapper">
            <div class="component__header">
                <span class="header__title">Waktu</span>
            </div>
            <div class="component__main">
                <span class="main__text" id="time__value"></span>
            </div>
            <div class="component__bottom">
                <span class="bottom__text" id="time__condition">Pagi</span>
            </div>
        </div>
        <div class="grid__component" id="light__wrapper">
            <div class="component__header">
                <span class="header__title">Cahaya</span>
            </div>
            <div class="component__main">
                <span class="main__text" id="light__value"></span>
            </div>
            <div class="component__bottom">
                <span class="bottom__text" id="light__condition">Terang</span>
            </div>
        </div>
        <div class="grid__component" id="rain__wrapper">
            <div class="component__header">
                <span class="header__title">Hujan</span>
            </div>
            <div class="component__main">
                <span class="main__text" id="rain__value"></span>
            </div>
            <div class="component__bottom">
                <span class="bottom__text" id="rain__condition">Tidak Hujan</span>
            </div>
        </div>
        <div class="grid__component" id="mist__wrapper">
            <div class="component__header">
                <span class="header__title">Kabut</span>
            </div>
            <div class="component__main">
                <span class="main__text" id="mist__value"></span>
            </div>
            <div class="component__bottom">
                <span class="bottom__text" id="mist__condition">Tidak Berkabut</span>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-analytics.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB7pGuiyxlyGnyWybU_VnNI40y-PvbJE9Q",
            authDomain: "smart-streetlight-167e7.firebaseapp.com",
            databaseURL: "https://smart-streetlight-167e7-default-rtdb.firebaseio.com",
            projectId: "smart-streetlight-167e7",
            storageBucket: "smart-streetlight-167e7.appspot.com",
            messagingSenderId: "1045922447632",
            appId: "1:1045922447632:web:914ac799135f7ca026e595",
            measurementId: "G-3QPKGEKPVM"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // Initialize Database
        const db = getDatabase(app);

        // Get Sensors
        const sensors = ['time', 'light', 'rain', 'mist'];
        const sensorsVal = ['00:00', 0, 0, 0];
        const sensorsCond = ['pagi', 'cerah', 'tidak hujan', 'tidak berkabut'];
        const sensorsParam = ['value', 'condition'];
        for (let i = 0; i < sensors.length; i++) {
            for (let j = 0; j < sensorsParam.length; j++) {
                const sensorRef = ref(db, 'sensors/' + sensors[i] + '/' + sensorsParam[j]);
                if (sensorsParam[j] == 'value') {
                    onValue(sensorRef, (snapshot) => {
                        sensorsVal[i] = snapshot.val();
                        const sensorValElem = document.getElementById(sensors[i] + '__value');
                        switch (sensors[i]) {
                            case 'time':
                                sensorValElem.innerHTML = sensorsVal[i];
                                break;
                            default:
                                sensorValElem.innerHTML = sensorsVal[i] + '%';
                                break;
                        }
                    })
                } else if (sensorsParam[j] == 'condition') {
                    onValue(sensorRef, (snapshot) => {
                        sensorsCond[i] = snapshot.val();
                        const sensorCondElem = document.getElementById(sensors[i] + '__condition');
                        sensorCondElem.innerHTML = sensorsCond[i];
                    })
                }
            }

            switch (sensors[i]) {
                case 'time':
                    if (sensors[i] == '03:00') {
                        sensorsCond[i] = 'dini hari';
                    } else if (sensors[i] == '05:00') {
                        sensorsCond[i] = 'pagi';
                    } else if (sensors[i] == '11:00') {
                        sensorsCond[i] = 'siang';
                    } else if (sensors[i] == '15:00') {
                        sensorsCond[i] = 'sore';
                    } else if (sensors[i] == '18:00') {
                        sensorsCond[i] = 'senja';
                    } else if (sensors[i] == '19:00') {
                        sensorsCond[i] = 'malam';
                    }
                    break;
            }
        }

        // Get Streetlight
        const streetlightCond = ['off', 'white'];
        const streetlightParam = ['state', 'color'];
        for (let i = 0; i < streetlightParam.length; i++) {
            const streetlightRef = ref(db, 'streetlight/' + streetlightParam[i]);
            onValue(streetlightRef, (snapshot) => {
                streetlightCond[i] = snapshot.val();
                const streetlightCondElem = document.getElementById('streetlight__' + streetlightParam[i]);
                streetlightCondElem.innerHTML = streetlightCond[i];
            })
        }

        console.log(sensorsVal);
      </script>
</body>
</html>